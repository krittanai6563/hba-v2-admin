import{k as ge,l as d,L as ye,C as he,m as Ve,e as xe,w as t,P as H,o as T,b as l,N as R,O,a as s,a9 as we,V as F,X as z,aa as J,ab as ee,c as A,f as _e,ac as le,M as r,ad as v,d as m,a3 as $,S as y,ae as ke,t as E,H as Fe,G as Ue,y as Me,u as Ee,h as Ce,x as Se,a4 as Te}from"./index-DIUjx3mN.js";import{d as te}from"./img-logo_0-DZHFey1b.js";import{u as B,w as $e}from"./xlsx-D1NZSDnX.js";import{_ as Be}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ne={class:"v-row"},De={class:"v-col-md-6 v-col-12 text-right"},Ie={class:"d-flex justify-end v-col-md-12 v-col-lg-12 v-col-12"},He={key:0,class:"mt-3"},Re={class:"v-card-text"},Oe={class:"v-table v-theme--BLUE_THEME v-table--density-default month-table"},Ae={class:"v-table__wrapper"},Le={key:0},Ye={class:"ps-0 py-3"},Pe={class:"d-flex align-center"},je=["src"],ze={class:"mx-4"},Je={class:"text-16 text-no-wrap font-weight-medium"},qe={class:"text-subtitle-1",style:{color:"red"}},Ge={class:"text-no-wrap text-subtitle-1 textSecondary"},We=["onSubmit"],Xe=ge({__name:"user",setup(Ke){const q=d(["วิสามัญ","วิสามัญ ก","สมทบ"]),h=d("วิสามัญ"),V=d(""),x=d(""),L=d(""),N=d(!1);d("");const G=d(["user","admin"]),w=d("user"),W=d({required:a=>!!a||"Required.",min:a=>a.length>=8||"Min 8 characters",emailMatch:()=>"The email and password you entered don't match"}),i=d(""),_=d(!1),c=d(null),ae=()=>{c.value?console.log("File selected:",c.value):i.value="กรุณาอัพโหลดไฟล์รูปภาพเท่านั้น!"};async function se(){i.value="",_.value=!1;try{const a=new FormData;a.append("fullname",V.value),a.append("email",x.value),a.append("password",L.value),a.append("role",w.value),a.append("member_type",h.value),c.value&&a.append("profile_image",c.value);const e=await fetch("https://thhbaadmin.infinityfreeapp.com/backend/register.php",{method:"POST",body:a}),o=await e.text();if(console.log(o),e.ok)try{let u=JSON.parse(o);i.value=u.message||"Registration successful!"}catch{i.value="Error: Invalid JSON format"}else i.value=`Registration failed: ${o}`}catch(a){a instanceof Error?i.value="Registration failed: "+a.message:i.value="Registration failed: An unexpected error occurred."}finally{_.value=!0}}const C=d([]),oe=d(["วิสามัญ","วิสามัญ ก","สมทบ"]);d(["user","admin"]);const ue=d(["กรอกข้อมูลเรียบร้อย","ยังไม่กรอกข้อมูล"]),b=d("");d("");const g=d(""),X=new Date().getFullYear(),ne=new Date().getMonth()+1,de=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],K=d([]);for(let a=1;a<=ne;a++){const e=a<10?`0${a}`:`${a}`;K.value.push({value:`${X}-${e}`,label:de[a-1]})}const S=d(""),k=d(""),Q=ye(()=>{let a=C.value;return b.value&&b.value!=="ทั้งหมด"&&(a=a.filter(e=>e.member_type===b.value)),g.value&&g.value!=="ทั้งหมด"&&(a=a.filter(e=>e.status===g.value)),a}),Y=async()=>{try{let a="https://thhbaadmin.infinityfreeapp.com/backend/get_members.php";if(k.value&&S.value){const[u,p]=S.value.split("-"),n=parseInt(u)+543,f=parseInt(p);a=`https://thhbaadmin.infinityfreeapp.com/backend/get_members.php?buddhist_year=${n}&month_number=${f}`}else k.value&&(a=`https://thhbaadmin.infinityfreeapp.com/backend/get_members.php?buddhist_year=${parseInt(k.value)+543}`);b.value&&b.value!=="ทั้งหมด"&&(a+=`&member_type=${b.value}`),g.value&&g.value!=="ทั้งหมด"&&(a+=`&status=${g.value}`),console.log("Fetching URL: ",a);const e=await fetch(a);if(!e.ok)throw new Error("Failed to fetch members");const o=await e.json();C.value=o,console.log("Members:",C.value)}catch(a){console.error(a)}};he([k,S],()=>{Y()}),Ve(()=>{Y()});function ie(a){return!a||a.trim()===""?te:`https://thhbaadmin.infinityfreeapp.com/backend/backend/${a}`}const Z=d([]);for(let a=0;a<7;a++){const e=X-a+543;Z.value.push(e.toString())}const re=d(!1);let D=null;function me(a){D=a;const e=C.value.find(o=>o.id===D);e&&(V.value=e.fullname||"",x.value=e.email||"",h.value=e.member_type||"",w.value=e.role||"user"),re.value=!0}async function fe(a){if(!D){i.value="No member selected for update.";return}try{const e=new FormData;e.append("id",D.toString()),e.append("fullname",V.value),e.append("email",x.value),e.append("role",w.value),e.append("member_type",h.value),c.value&&e.append("profile_image",c.value);const o=await fetch("https://thhbaadmin.infinityfreeapp.com/backend/edit_profile.php",{method:"POST",body:e}),u=await o.text();if(console.log(u),o.ok)try{let p=JSON.parse(u);i.value=p.message||"Profile updated successfully!",_.value=!0,a.value=!1,setTimeout(()=>{_.value=!1},3e3),await Y()}catch{i.value="Error: Invalid JSON format"}else i.value=`Update failed: ${u}`}catch(e){e instanceof Error?i.value="Update failed: "+e.message:i.value="Update failed: An unexpected error occurred."}}function pe(){_.value=!1,i.value=""}function ve(){const a=["ลำดับ","ชื่อบริษัท","ปี/เดือน"];let e=0,o=0;const u={};C.value.forEach((n,f)=>{const P=[f+1,n.fullname,n.status==="กรอกข้อมูลเรียบร้อย"?"✓":"❌"];u[n.member_type]||(u[n.member_type]=[]),u[n.member_type].push(P),e++,n.status!=="กรอกข้อมูลเรียบร้อย"&&o++});const p=B.book_new();Object.keys(u).forEach(n=>{const f=[],P=`${n} (หมวดหมู่)`;f.push([P,"",""]),f.push([]),f.push(a);const U=B.aoa_to_sheet(f);u[n].forEach((j,ce)=>{f.push(j);const be=ce+2,M=B.encode_cell({r:be,c:2});j[2]==="❌"?(U[M]||(U[M]={}),U[M].s={fill:{patternType:"solid",fgColor:{rgb:"FF9999"}}}):j[2]==="✓"&&(U[M]||(U[M]={}),U[M].s={fill:{patternType:"solid",fgColor:{rgb:"FFFFFF"}}})}),f.push(["รวม","",e]),f.push(["ยังไม่ได้กรอก","",o]);const I=B.aoa_to_sheet(f);I["!cols"]=[{wch:10},{wch:20},{wch:12}],I["!merges"]=[{s:{r:0,c:0},e:{r:0,c:2}}],I["!merges"].push({s:{r:f.length-2,c:0},e:{r:f.length-2,c:1}},{s:{r:f.length-1,c:0},e:{r:f.length-1,c:1}}),B.book_append_sheet(p,I,n)}),$e(p,"members_data.xlsx")}return(a,e)=>(T(),xe(H,null,{default:t(()=>[l(r,{cols:"12",sm:"12",lg:"12"},{default:t(()=>[l(R,{elevation:"0"},{default:t(()=>[l(O,null,{default:t(()=>[s("div",Ne,[e[27]||(e[27]=s("div",{class:"v-col-md-6 v-col-12"},[s("div",{class:"d-flex align-center"},[s("div",null,[s("h3",{class:"card-title mb-1"},"ลงทะเบียนสมาชิก"),s("h5",{class:"card-subtitle",style:{"text-align":"left"}},"จัดการข้อมูลสมาชิกสมาคม")])])],-1)),s("div",De,[s("div",Ie,[l(we,{color:"#b2d7ef",density:"comfortable",rounded:"pill",divided:""},{default:t(()=>[l(F,{class:"v-btn v-btn--flat v-theme--BLUE_THEME bg-primary v-btn--density-default v-btn--rounded v-btn--size-default"},{default:t(()=>[e[25]||(e[25]=s("div",{class:"text-none font-weight-regular primary"},"เพิ่มข้อมูลสมาชิกสมาคม",-1)),l(z,{activator:"parent","max-width":"800"},{default:t(({isActive:o})=>[l(R,{rounded:"lg"},{default:t(()=>[l(J,{class:"d-flex justify-space-between align-center ps-5 py-5"},{default:t(()=>[e[17]||(e[17]=s("div",{class:"text-h5 text-medium-emphasis ps-2"},[s("h3",{class:"text-h3 mb-1"},"ลงทะเบียนสมาชิก"),s("div",{class:"text-subtitle-1 opacity-80",style:{"font-weight":"300"}}," เพิ่มข้อมูลสมาชิกสมาคม ")],-1)),l(F,{icon:"mdi-close",variant:"text",onClick:u=>o.value=!1},null,8,["onClick"])]),_:2},1024),l(ee,{class:"mb-4"}),l(O,null,{default:t(()=>[s("form",{onSubmit:le(se,["prevent"])},[l(H,null,{default:t(()=>[l(r,{cols:"12",sm:"6"},{default:t(()=>[l(v,{class:"mb-1"},{default:t(()=>e[18]||(e[18]=[m("ชื่อบริษัท")])),_:1}),l($,{id:"fullname",modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=u=>V.value=u),variant:"outlined","hide-details":"",color:"primary"},null,8,["modelValue"])]),_:1}),l(r,{cols:"12",sm:"6"},{default:t(()=>[l(v,{class:"mb-1"},{default:t(()=>e[19]||(e[19]=[m("ประเภทสมาชิก")])),_:1}),l(y,{items:q.value,modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=u=>h.value=u)},null,8,["items","modelValue"])]),_:1}),l(r,{cols:"12",sm:"6"},{default:t(()=>[l(v,{class:"mb-1"},{default:t(()=>e[20]||(e[20]=[m("อีเมล")])),_:1}),l($,{variant:"outlined",type:"email","hide-details":"",color:"primary",id:"email",modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=u=>x.value=u)},null,8,["modelValue"])]),_:1}),l(r,{cols:"12",sm:"6"},{default:t(()=>[l(v,{class:"mb-1"},{default:t(()=>e[21]||(e[21]=[m("รหัสผ่าน")])),_:1}),l($,{id:"password",modelValue:L.value,"onUpdate:modelValue":e[3]||(e[3]=u=>L.value=u),"append-icon":N.value?"mdi-eye":"mdi-eye-off",rules:[W.value.required,W.value.min],type:N.value?"text":"password",name:"input-10-1",hint:"At least 8 characters",counter:"","onClick:append":e[4]||(e[4]=u=>N.value=!N.value),"hide-details":""},null,8,["modelValue","append-icon","rules","type"])]),_:1}),l(r,{cols:"12"},{default:t(()=>[l(v,{class:"mb-1"},{default:t(()=>e[22]||(e[22]=[m("สิทธิการเข้าถึงข้อมูล")])),_:1}),l(y,{items:G.value,modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=u=>w.value=u),"hide-details":""},null,8,["items","modelValue"])]),_:1}),l(r,{cols:"12"},{default:t(()=>[l(v,{class:"mb-1"},{default:t(()=>e[23]||(e[23]=[m("อัพโหลดรูปโปรไฟล์")])),_:1}),l(ke,{label:"File input",modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=u=>c.value=u),accept:"image/*",onChange:ae},null,8,["modelValue"])]),_:1}),l(r,{cols:"12"},{default:t(()=>[l(F,{type:"submit",color:"primary",size:"large",block:"",flat:"",class:"w-100"},{default:t(()=>e[24]||(e[24]=[m(" สมัครสมาชิก ")])),_:1})]),_:1})]),_:1})],32),i.value?(T(),A("p",He,E(i.value),1)):_e("",!0)]),_:1}),l(ee,{class:"mt-2"})]),_:2},1024)]),_:1})]),_:1})]),_:1}),l(F,{class:"text-primary v-btn--size-small ml-4",onClick:ve},{default:t(()=>e[26]||(e[26]=[s("div",{class:"text-none font-weight-regular muted"},"Export to CSV",-1)])),_:1})])])]),e[39]||(e[39]=s("br",null,null,-1)),e[40]||(e[40]=s("br",null,null,-1)),l(H,{class:"mb-4",dense:""},{default:t(()=>[l(r,{cols:"12",sm:"3"},{default:t(()=>[l(y,{modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=o=>k.value=o),items:Z.value,label:"ประจำปี",dense:"",clearable:"","menu-props":{maxHeight:"200"}},null,8,["modelValue","items"])]),_:1}),l(r,{cols:"12",sm:"3"},{default:t(()=>[l(y,{modelValue:S.value,"onUpdate:modelValue":e[8]||(e[8]=o=>S.value=o),items:K.value,label:"เดือน",dense:"",clearable:"","item-title":"label","item-value":"value","menu-props":{maxHeight:"200"},disabled:!k.value},null,8,["modelValue","items","disabled"])]),_:1}),l(r,{cols:"12",sm:"3"},{default:t(()=>[l(y,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=o=>b.value=o),items:["ทั้งหมด",...oe.value],label:"ประเภทสมาชิก",dense:"",clearable:"","menu-props":{maxHeight:"200"}},null,8,["modelValue","items"])]),_:1}),l(r,{cols:"12",sm:"3"},{default:t(()=>[l(y,{modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=o=>g.value=o),items:["ทั้งหมด",...ue.value],label:"สถานะ",dense:"",clearable:"","menu-props":{maxHeight:"200"}},null,8,["modelValue","items"])]),_:1})]),_:1}),s("div",Re,[s("div",Oe,[s("div",Ae,[s("table",null,[e[38]||(e[38]=s("thead",null,[s("tr",null,[s("th",{class:"text-subtitle-1 font-weight-medium ps-2"},"สมาชิก"),s("th",{class:"text-subtitle-1 font-weight-medium"},"อีเมล"),s("th",{class:"text-subtitle-1 font-weight-medium"},"สถานะ"),s("th",{class:"text-subtitle-1 font-weight-medium"})])],-1)),s("tbody",null,[Q.value.length===0?(T(),A("tr",Le,e[28]||(e[28]=[s("td",{colspan:"4",class:"text-center text-subtitle-1 py-4"},"ไม่พบข้อมูลมูลสมาชิก",-1)]))):(T(!0),A(Ue,{key:1},Fe(Q.value,(o,u)=>(T(),A("tr",{key:u},[s("td",Ye,[s("div",Pe,[l(Me,{size:"48"},{default:t(()=>[s("img",{src:ie(o.profile_image),alt:"user",style:{width:"48px",height:"48px","border-radius":"50%","object-fit":"cover"},onError:e[11]||(e[11]=p=>{const n=p.target;n&&(n.src=Ee(te))})},null,40,je)]),_:2},1024),s("div",ze,[s("h4",Je,E(o.fullname),1),s("span",qe,E(o.member_type),1)])])]),s("td",null,[s("h5",Ge,E(o.email),1)]),s("td",null,[l(Ce,{color:o.status==="กรอกข้อมูลเรียบร้อย"?"success":"error",label:"",small:"",class:"ma-2 rounded-pill"},{default:t(()=>[m(E(o.status),1)]),_:2},1032,["color"])]),s("td",null,[l(z,{"max-width":"500"},{activator:t(({props:p})=>[l(F,Se({ref_for:!0},p,{variant:"flat",onClick:n=>me(o.id)}),{default:t(()=>e[29]||(e[29]=[s("i",{class:"mdi-pencil mdi v-icon notranslate v-theme--BLUE_THEME v-icon--size-small text-info v-icon--clickable me-2",role:"button","aria-hidden":"false",tabindex:"0"},null,-1)])),_:2},1040,["onClick"])]),default:t(({isActive:p})=>[l(R,{rounded:"lg"},{default:t(()=>[l(J,null,{default:t(()=>e[30]||(e[30]=[m(" แก้ไขข้อมูลสมาชิก ")])),_:1}),l(O,null,{default:t(()=>[s("form",{onSubmit:le(n=>fe(p),["prevent"])},[l(H,null,{default:t(()=>[l(r,{cols:"12",sm:"6"},{default:t(()=>[l(v,null,{default:t(()=>e[31]||(e[31]=[m("ชื่อบริษัท")])),_:1}),l($,{modelValue:V.value,"onUpdate:modelValue":e[12]||(e[12]=n=>V.value=n),readonly:""},null,8,["modelValue"])]),_:1}),l(r,{cols:"12",sm:"6"},{default:t(()=>[l(v,null,{default:t(()=>e[32]||(e[32]=[m("ประเภทสมาชิก")])),_:1}),l(y,{modelValue:h.value,"onUpdate:modelValue":e[13]||(e[13]=n=>h.value=n),items:q.value},null,8,["modelValue","items"])]),_:1}),l(r,{cols:"12"},{default:t(()=>[l(v,null,{default:t(()=>e[33]||(e[33]=[m("อีเมล")])),_:1}),l($,{modelValue:x.value,"onUpdate:modelValue":e[14]||(e[14]=n=>x.value=n),readonly:""},null,8,["modelValue"])]),_:1}),l(r,{cols:"12"},{default:t(()=>[l(v,null,{default:t(()=>e[34]||(e[34]=[m("สิทธิการเข้าถึงข้อมูล")])),_:1}),l(y,{modelValue:w.value,"onUpdate:modelValue":e[15]||(e[15]=n=>w.value=n),items:G.value},null,8,["modelValue","items"])]),_:1}),l(r,{cols:"12"},{default:t(()=>[l(F,{type:"submit",color:"primary"},{default:t(()=>e[35]||(e[35]=[m("บันทึกการแก้ไข")])),_:1})]),_:1})]),_:1})],40,We)]),_:2},1024)]),_:2},1024)]),_:2},1024),l(z,{modelValue:_.value,"onUpdate:modelValue":e[16]||(e[16]=p=>_.value=p),"max-width":"400px"},{default:t(()=>[l(R,null,{default:t(()=>[l(J,{class:"text-h6"},{default:t(()=>e[36]||(e[36]=[m("แจ้งเตือน")])),_:1}),l(O,null,{default:t(()=>[m(E(i.value),1)]),_:1}),l(Te,null,{default:t(()=>[l(F,{color:"primary",text:"",onClick:pe},{default:t(()=>e[37]||(e[37]=[m("ปิด")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]))),128))])])])])])]),_:1})]),_:1})]),_:1})]),_:1}))}}),tl=Be(Xe,[["__scopeId","data-v-48ad6479"]]);export{tl as default};
