import{af as Z,k as ee,L as b,l as V,m as te,c as ae,b as l,w as n,M as v,P as N,G as le,o as se,a as o,N as Q,O as $,S as T,t as L,r as oe}from"./index-DIUjx3mN.js";Z();const re={class:"card-subtitle"},ne={class:"card-subtitle"},ce=ee({__name:"report",setup(ue){const E=["2567","2568"],O=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],I=["Q1","Q2","Q3","Q4"],M=["เปรียบเทียบเดือน","เปรียบเทียบปี","เปรียบเทียบไตรมาส"],z=b(()=>h.value==="เปรียบเทียบปี"?E:h.value==="เปรียบเทียบไตรมาส"?["ไตรมาส 1","ไตรมาส 2","ไตรมาส 3","ไตรมาส 4"]:h.value==="เปรียบเทียบเดือน"?O:[]),x=V(""),B=V(""),_=V(""),h=V(""),F=V(""),X=new Date().getFullYear()+543,P=localStorage.getItem("user_id"),A=localStorage.getItem("user_role")||"user",m=V({yearly_data:{},quarterly_data:{}});b(()=>["2567","2568"]);const R=V(!0),U=async()=>{if(!(A!=="admin"&&!P)){R.value=!0;try{const a=await fetch("https://thhbaadmin.infinityfreeapp.com/backend/roport_pricerange.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:P,role:A,year:X.toString()})});if(!a.ok)throw new Error(`HTTP ${a.status}`);const e=await a.json();if(console.log("Fetched Summary Data:",e),e&&e.yearly_data&&e.quarterly_data)m.value=e;else throw new Error("Incomplete data received")}catch(a){console.error("Error fetching summary:",a),m.value={yearly_data:{},quarterly_data:{},yearly_data_quarterly:{}}}finally{R.value=!1}}};te(async()=>{await U(),console.log("Summary Data:",m.value)});const q=(a,e)=>a===0?e===0?0:100:(e-a)/a*100;b(()=>{const a=["ไม่เกิน 2.50 ล้านบาท","2.51 - 5 ล้านบาท","5.01 - 10 ล้านบาท","10.01 - 20 ล้านบาท","20.01 ล้านขึ้นไป"];if(h.value==="เปรียบเทียบไตรมาส")return[];if(h.value==="เปรียบเทียบปี"){const e=x.value,u=F.value,i=a.reduce((r,c)=>{var f,p;const d=((p=(f=m.value.yearly_data)==null?void 0:f[e])==null?void 0:p[c])||0;return r+d},0),k=a.reduce((r,c)=>{var f,p;const d=((p=(f=m.value.yearly_data)==null?void 0:f[u])==null?void 0:p[c])||0;return r+d},0),g=a.map(r=>{var f,p,C,w;const c=((p=(f=m.value.yearly_data)==null?void 0:f[e])==null?void 0:p[r])||0,d=((w=(C=m.value.yearly_data)==null?void 0:C[u])==null?void 0:w[r])||0;return q(c,d)}),y=q(i,k);return[{name:`ปี ${e}`,type:"column",data:[...a.map(r=>{var c,d;return((d=(c=m.value.yearly_data)==null?void 0:c[e])==null?void 0:d[r])||0}),i],color:"#008FFB"},{name:`ปี ${u}`,type:"column",data:[...a.map(r=>{var c,d;return((d=(c=m.value.yearly_data)==null?void 0:c[u])==null?void 0:d[r])||0}),k],color:"#00E396"},{name:"เปอร์เซ็นต์การเปลี่ยนแปลง",type:"line",data:[...g,y],color:"#FF4560",dataLabels:{enabled:!0,formatter:function(r){return`${r.toFixed(2)}%`}}}]}return[]}),b(()=>({chart:{height:350,type:"line",stacked:!1,fontFamily:"inherit",foreColor:"#adb0bb",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:4,columnWidth:"90%",dataLabels:{position:"top",offsetY:0}},line:{dataLabels:{position:"top",offsetY:0},curve:"smooth"}},dataLabels:{enabled:!0,position:"top",offsetY:-13,style:{fontSize:"10px"}},stroke:{width:[2,2,4],curve:"smooth"},grid:{show:!0,strokeDashArray:4,borderColor:"rgba(0, 0, 0, 0.1)"},xaxis:{categories:["ไม่เกิน 2.50 ล้านบ้าน","2.51 - 5 ล้านบาท","5.01 - 10 ล้านบาท","10.01 - 20 ล้านบาท","20 ล้านบาท","รวม"]},yaxis:[{seriesName:"ปี 2567",axisTicks:{show:!0},labels:{show:!1,style:{colors:"#008FFB"}},tooltip:{enabled:!0}},{seriesName:"ปี 2568",opposite:!0,axisTicks:{show:!0},labels:{show:!1,style:{colors:"#00E396"}}},{seriesName:"เปอร์เซ็นต์การเปลี่ยนแปลง",opposite:!1,axisTicks:{show:!0},labels:{show:!1,style:{colors:"#FF4560"}}}],tooltip:{fixed:{enabled:!0,position:"topLeft",offsetY:0,offsetX:0}},legend:{horizontalAlign:"center",offsetX:0}}));const S=b(()=>{switch(_.value){case"Q1":return["มกราคม","กุมภาพันธ์","มีนาคม"];case"Q2":return["เมษายน","พฤษภาคม","มิถุนายน"];case"Q3":return["กรกฎาคม","สิงหาคม","กันยายน"];case"Q4":return["ตุลาคม","พฤศจิกายน","ธันวาคม"];default:return[]}}),j={January:"มกราคม",February:"กุมภาพันธ์",March:"มีนาคม",April:"เมษายน",May:"พฤษภาคม",June:"มิถุนายน",July:"กรกฎาคม",August:"สิงหาคม",September:"กันยายน",October:"ตุลาคม",November:"พฤศจิกายน",December:"ธันวาคม"},J=b(()=>{var w,Y;const a=x.value,e=F.value,u=_.value,i=((w=m.value.quarterly_data[a])==null?void 0:w[u])||{},k=((Y=m.value.quarterly_data[e])==null?void 0:Y[u])||{},g=Object.fromEntries(Object.entries(i).map(([t,s])=>[j[t]||t,s])),y=Object.fromEntries(Object.entries(k).map(([t,s])=>[j[t]||t,s])),r=S.value.map(t=>g[t]||0),c=S.value.map(t=>y[t]||0),d=S.value.map(t=>{const s=g[t]||0,D=y[t]||0;return q(s,D)}),f=S.value.map(t=>g[t]||0),p=S.value.map(t=>y[t]||0),C=q(r.reduce((t,s)=>t+s,0),c.reduce((t,s)=>t+s,0));return[{name:`ไตรมาส ${u.replace("Q","")} ปี ${a}`,type:"column",data:[...f,r.reduce((t,s)=>t+s,0)]},{name:`ไตรมาส ${u.replace("Q","")} ปี ${e}`,type:"column",data:[...p,c.reduce((t,s)=>t+s,0)]},{name:"เปอร์เซ็นต์การเปลี่ยนแปลง ",type:"line",data:[...d,C],color:"#FF4560",dataLabels:{enabled:!0,formatter:function(t){return`${t.toFixed(2)}%`}}}]}),H=b(()=>({chart:{height:300,width:"100%",type:"line",stacked:!1,fontFamily:"inherit",foreColor:"#adb0bb",toolbar:{show:!1}},plotOptions:{line:{dataLabels:{enabled:!0,position:"top",offsetY:-20},curve:"smooth"}},dataLabels:{enabled:!0,position:"top",offsetY:-20,formatter:function(a){return a.toLocaleString()},style:{fontSize:"10px"}},stroke:{width:1,curve:"smooth"},grid:{show:!0,strokeDashArray:4,borderColor:"rgba(0, 0, 0, 0.1)"},xaxis:{categories:[...S.value,"รวม"],labels:{style:{colors:"#a1aab2"}}},yaxis:[{seriesName:"Income",axisTicks:{show:!1},labels:{show:!1,style:{colors:"#00E396"}},tooltip:{enabled:!1}},{seriesName:"Cashflow",opposite:!1,axisTicks:{show:!1},labels:{show:!1,style:{colors:"#FEB019"}}},{seriesName:"Revenue",opposite:!1,axisTicks:{show:!1},labels:{show:!1,style:{colors:"#008FFB"}}}],tooltip:{fixed:{enabled:!0,position:"topLeft",offsetY:0,offsetX:0}},legend:{horizontalAlign:"center",offsetX:0}})),W=b(()=>{var C,w,Y,t;const a=x.value,e=F.value,u=_.value,i=((w=(C=m.value.yearly_data_quarterly)==null?void 0:C[a])==null?void 0:w[u])||{},k=((t=(Y=m.value.yearly_data_quarterly)==null?void 0:Y[e])==null?void 0:t[u])||{};console.log("quarterData1:",i),console.log("quarterData2:",k);const g=["ไม่เกิน 2.50 ล้านบาท","2.51 - 5 ล้านบาท","5.01 - 10 ล้านบาท","10.01 - 20 ล้านบาท","20.01 ล้านขึ้นไป"],y=g.map(s=>i[s]||0),r=g.map(s=>k[s]||0),c=y.map((s,D)=>{const K=r[D]||0;return q(s,K)}),d=y.reduce((s,D)=>s+D,0),f=r.reduce((s,D)=>s+D,0),p=q(d,f);return[{name:`${a} ไตรมาส ${u}`,type:"column",data:[...y,d],color:"#008FFB"},{name:`${e} ไตรมาส ${u}`,type:"column",data:[...r,f],color:"#00E396"},{name:"เปอร์เซ็นต์การเปลี่ยนแปลง",type:"line",data:[...c,p],color:"#FF4560",dataLabels:{enabled:!0,formatter:function(s){return`${s.toFixed(2)}%`}}}]}),G=b(()=>({chart:{height:250,type:"line",stacked:!1,fontFamily:"inherit",foreColor:"#adb0bb",toolbar:{show:!1}},plotOptions:{bar:{borderRadius:5,columnWidth:"55%",dataLabels:{position:"top",offsetY:-20}}},dataLabels:{enabled:!0,position:"top",offsetY:-20,formatter:function(a){return a.toLocaleString()},style:{fontSize:"10px"}},stroke:{width:[1,1,4]},grid:{show:!0,strokeDashArray:4,borderColor:"rgba(0, 0, 0, 0.1)"},xaxis:{categories:["ไม่เกิน 2.50 ล้านบ้าน","2.51 - 5 ล้านบาท","5.01 - 10 ล้านบาท","10.01 - 20 ล้านบาท","20 ล้านบาท","รวม"]},yaxis:[{seriesName:"Income",axisTicks:{show:!0},labels:{show:!1,style:{colors:"#00E396"}},tooltip:{enabled:!0}},{seriesName:"Cashflow",opposite:!0,axisTicks:{show:!0},labels:{show:!1,style:{colors:"#FEB019"}}},{seriesName:"Revenue",opposite:!0,axisTicks:{show:!0},labels:{show:!1,style:{colors:"#008FFB"}}}],tooltip:{fixed:{enabled:!0,position:"topLeft",offsetY:0,offsetX:0}},legend:{horizontalAlign:"center",offsetX:0}}));return(a,e)=>{const u=oe("apexchart");return se(),ae(le,null,[l(v,{cols:"12"},{default:n(()=>e[5]||(e[5]=[o("div",{class:"mt-3 mb-6"},[o("div",{class:"d-flex justify-space-between"},[o("div",{class:"d-flex py-0 align-center"},[o("div",null,[o("h3",{class:"text-h5 card-title"},"รายงานเปรียบเทียบยอดเซ็นสัญญา"),o("ul",{class:"v-breadcrumbs v-breadcrumbs--density-default text-subtitle-1 textSecondary pa-0 ml-n1"},[o("li",{class:"v-breadcrumbs-item"},[o("a",{class:"v-breadcrumbs-item--link",href:"#"},[o("p",null,"หน้าแรก")])]),o("li",{class:"v-breadcrumbs-divider"},[o("i",{class:"mdi-chevron-right mdi v-icon"})]),o("li",{class:"v-breadcrumbs-item"},[o("a",{class:"v-breadcrumbs-item--link",href:"#"},[o("p",null,"สรุปรายงาน")])])])])])])],-1)])),_:1}),l(N,null,{default:n(()=>[l(v,{cols:"12"},{default:n(()=>[l(Q,null,{default:n(()=>[l($,null,{default:n(()=>[e[6]||(e[6]=o("h3",{class:"card-title mb-1"},"เลือกข้อมูลที่ใช้สำหรับเปรียบเทียบยอดเซ็นสัญญา",-1)),e[7]||(e[7]=o("h5",{class:"card-subtitle"},"สามารถเลือกข้อมูลสำหรับการค้นหา",-1)),e[8]||(e[8]=o("br",null,null,-1)),l(N,null,{default:n(()=>[l(v,{cols:"12",md:"4"},{default:n(()=>[l(T,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=i=>x.value=i),items:E,label:"เลือกปี","item-text":"year","item-value":"year",outlined:""},null,8,["modelValue"])]),_:1}),l(v,{cols:"12",md:"4"},{default:n(()=>[l(T,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=i=>B.value=i),items:O,label:"เลือกเดือน","item-text":"text","item-value":"value",outlined:""},null,8,["modelValue"])]),_:1}),l(v,{cols:"12",md:"4"},{default:n(()=>[l(T,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=i=>_.value=i),items:I,label:"เลือกไตรมาส","item-text":"text","item-value":"value",outlined:""},null,8,["modelValue"])]),_:1}),l(v,{cols:"12",md:"4"},{default:n(()=>[l(T,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=i=>h.value=i),items:M,label:"เลือกประเภทการเปรียบเทียบ",outlined:""},null,8,["modelValue"])]),_:1}),l(v,{cols:"12",md:"4"},{default:n(()=>[l(T,{modelValue:F.value,"onUpdate:modelValue":e[4]||(e[4]=i=>F.value=i),items:z.value,label:"เลือกช่วงเวลาในการเปรียบเทียบ",disabled:!h.value,outlined:""},null,8,["modelValue","items","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(N,null,{default:n(()=>[l(v,{cols:"12"},{default:n(()=>[l(Q,null,{default:n(()=>[l($,null,{default:n(()=>[e[9]||(e[9]=o("h3",{class:"card-title mb-1"},"กราฟเปรียบเทียบยอดเซ็นสัญญา แยกตามไตรมาส",-1)),o("h5",re," ไตรมาส "+L(_.value)+" ปี "+L(x.value)+" - "+L(F.value),1),l(u,{type:"line",height:"350",options:H.value,series:J.value},null,8,["options","series"])]),_:1})]),_:1})]),_:1})]),_:1}),l(N,null,{default:n(()=>[l(v,{cols:"12"},{default:n(()=>[l(Q,null,{default:n(()=>[l($,null,{default:n(()=>[e[10]||(e[10]=o("h3",{class:"card-title mb-1"},"กราฟเปรียบเทียบยอดเซ็นสัญญา แยกตามราคาบ้าน",-1)),o("h5",ne," ไตรมาส "+L(_.value)+" ปี "+L(x.value)+" - "+L(F.value),1),l(u,{height:"350",options:G.value,series:W.value},null,8,["options","series"])]),_:1})]),_:1})]),_:1})]),_:1})],64)}}});export{ce as default};
