import{u as w,w as J}from"./xlsx-D1NZSDnX.js";import{k as W,l as B,C as K,m as Z,L as Q,e as tt,w as h,P as et,o as u,b as d,a as t,M as D,N as Y,O as A,t as m,S as st,u as ot,r as lt,V as at,c as f,H as y,G as b}from"./index-DIUjx3mN.js";const rt={class:"v-row"},nt={class:"v-col-md-8 v-col-12"},it={class:"d-flex align-center"},ct={class:"card-title mb-1"},ut={class:"v-col-md-4 v-col-12 text-right"},dt={class:"d-flex justify-end v-col-md-12 v-col-lg-12 v-col-12"},ht={class:"mt-5"},mt={class:"v-row"},ft={class:"v-col-md-6 v-col-12"},vt={class:"d-flex align-center"},pt={class:"card-title mb-1"},_t={class:"v-col-md-6 v-col-12 text-right"},gt={class:"d-flex justify-end v-col-md-12 v-col-lg-12 v-col-12"},bt={class:"v-table v-theme--BLUE_THEME v-table--density-default month-table"},xt={class:"v-table__wrapper"},yt={style:{"background-color":"#F5F5F5"}},wt=["colspan"],Ft={class:"text-h6"},St={style:{"background-color":"#fcf8ff"}},kt={colspan:2},Tt={class:"text-p",style:{"font-size":"14px","font-weight":"600",color:"#725AF2"}},Et={class:"text-subtitle-1"},Ct={class:"text-subtitle-1"},Bt={style:{"background-color":"#FFF3E0"}},Ht=W({__name:"Shadow",setup(Dt){const F=new Date().getFullYear()+543,S=new Date().getMonth()+1,c=B(F.toString()),O=Array.from({length:7},(s,e)=>(F-e).toString()),_=B({}),L=localStorage.getItem("user_id"),j=localStorage.getItem("user_role")||"user",x=["ไม่เกิน 2.50 ล้านบาท","2.51 - 5 ล้านบาท","5.01 - 10 ล้านบาท","10.01 - 20 ล้านบาท","20.01 ล้านขึ้นไป"],k=["จำนวนหลัง","มูลค่ารวม","พื้นที่ใช้สอย","ราคาเฉลี่ย/ตร.ม."],T={จำนวนหลัง:"unit",มูลค่ารวม:"value",พื้นที่ใช้สอย:"area","ราคาเฉลี่ย/ตร.ม.":"price_per_sqm"},q=()=>c.value!==F.toString()?4:S<=3?1:S<=6?2:S<=9?3:4,V=async()=>{if(L)try{const s=await fetch("https://thhbaadmin.infinityfreeapp.com/backend/quarter_summary.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:L,year:c.value,role:j})});if(!s.ok)throw new Error(`HTTP ${s.status}`);_.value=await s.json()}catch(s){console.error("Error fetching summary:",s)}};K(c,V),Z(V);const i=Q(()=>{const s=q();return["Q1","Q2","Q3","Q4"].filter((e,n)=>n<s).map(e=>`${e} ${c.value}`)}),z=B({chart:{height:350,type:"line",stacked:!1,fontFamily:"inherit",foreColor:"#adb0bb",toolbar:{show:!0,tools:{download:!0}},responsive:[{breakpoint:1e3,options:{chart:{width:"100%"}}}]},plotOptions:{bar:{borderRadius:4,columnWidth:"40%",dataLabels:{position:"top",offsetY:0}},line:{dataLabels:{position:"top",offsetY:0},curve:"smooth"}},dataLabels:{enabled:!0,position:"top",offsetY:-13,style:{fontSize:"10px"},formatter:s=>s>=1e3?s.toLocaleString("th-TH"):s.toString()},stroke:{width:[2,2,4],curve:"smooth"},grid:{show:!0,strokeDashArray:4,borderColor:"rgba(0, 0, 0, 0.1)"},xaxis:{categories:i.value,labels:{rotate:-45,style:{fontSize:"12px",colors:"#6c757d"}}},yaxis:[{seriesName:"จำนวนหลัง",axisTicks:{show:!1},axisBorder:{show:!1,color:"#008FFB"},labels:{show:!1,style:{colors:"#008FFB"}},tooltip:{enabled:!1}},{seriesName:"พื้นที่ใช้สอย",opposite:!1,axisTicks:{show:!1},axisBorder:{show:!1,color:"#00E396"},labels:{show:!1,style:{colors:"#00E396"}}},{seriesName:"มูลค่ารวม",opposite:!1,axisTicks:{show:!0},axisBorder:{show:!1,color:"#FEB019"},labels:{show:!1,style:{colors:"#FEB019"}}}],tooltip:{fixed:{enabled:!1,position:"topLeft",offsetY:0,offsetX:0}},legend:{horizontalAlign:"center",offsetX:0}}),R=Q(()=>[{name:"จำนวนหลัง",type:"column",data:i.value.map(s=>{const[e]=s.split(" ");return parseFloat(x.reduce((n,o)=>{var a,r;const l=((r=(a=_.value[e])==null?void 0:a[o])==null?void 0:r.unit)||0;return n+l},0).toFixed(2))}),color:"#F9C80E"},{name:"พื้นที่ใช้สอย",type:"column",data:i.value.map(s=>{const[e]=s.split(" ");return parseFloat(x.reduce((n,o)=>{var a,r;const l=((r=(a=_.value[e])==null?void 0:a[o])==null?void 0:r.area)||0;return n+l},0).toFixed(2))}),color:"#2983FF"},{name:"มูลค่ารวม",type:"line",data:i.value.map(s=>{const[e]=s.split(" ");return parseFloat(x.reduce((n,o)=>{var a,r;const l=((r=(a=_.value[e])==null?void 0:a[o])==null?void 0:r.value)||0;return n+l},0).toFixed(2))}),color:"#D7263D"}]),H=(s,e=!1)=>e?s.toLocaleString("th-TH",{minimumFractionDigits:2,maximumFractionDigits:2}):s.toLocaleString("th-TH"),$=(s,e)=>H(i.value.reduce((n,o)=>{var a,r;const[l]=o.split(" ");return n+(((r=(a=_.value[l])==null?void 0:a[s])==null?void 0:r[e])||0)},0)),P=()=>{const s=w.book_new(),n=[["รายงานเปรียบเทียบยอดเซ็นสัญญา",...i.value,"รวม"]],o=[];let l=1;x.forEach(r=>{const v=Array(i.value.length+1).fill("");n.push([r,...v]),o.push({s:{r:l,c:0},e:{r:l,c:i.value.length+1}}),l++,k.forEach(p=>{const g=[p];let E=0;i.value.forEach(I=>{var N,M;const X=I.split(" ")[0],C=((M=(N=_.value[X])==null?void 0:N[r])==null?void 0:M[T[p]])||0;E+=C;const G=p==="ราคาเฉลี่ย/ตร.ม."?C.toLocaleString("th-TH",{minimumFractionDigits:2,maximumFractionDigits:2}):C.toLocaleString("th-TH");g.push(G)});const U=p==="ราคาเฉลี่ย/ตร.ม."?E.toLocaleString("th-TH",{minimumFractionDigits:2,maximumFractionDigits:2}):E.toLocaleString("th-TH");g.push(U),n.push(g),l++}),n.push([]),l++});const a=w.aoa_to_sheet(n);a["!cols"]=[{wch:35},...i.value.map(()=>({wch:15})),{wch:15}],a["!merges"]=o,n.forEach((r,v)=>{if(v>0&&v<=k.length)for(let p=0;p<r.length;p++){const g=a[w.encode_cell({r:v,c:p})];g&&(g.s={fill:{fgColor:{rgb:"FFFF00"}}})}}),w.book_append_sheet(s,a,"ตารางรายงาน"),J(s,`รายงานแบ่งตามไตรมาส_${c.value}.xlsx`)};return(s,e)=>{const n=lt("apexchart");return u(),tt(et,null,{default:h(()=>[d(D,{cols:"12"},{default:h(()=>e[1]||(e[1]=[t("div",{class:"mt-3 mb-6"},[t("div",{class:"d-flex justify-space-between"},[t("div",{class:"d-flex py-0 align-center"},[t("div",null,[t("h3",{class:"text-h5 card-title"},"รายงานแบ่งตามไตรมาส"),t("ul",{class:"v-breadcrumbs v-breadcrumbs--density-default text-subtitle-1 textSecondary pa-0 ml-n1"},[t("li",{class:"v-breadcrumbs-item"},[t("a",{class:"v-breadcrumbs-item--link",href:"#"},[t("p",null,"หน้าแรก")])]),t("li",{class:"v-breadcrumbs-divider"},[t("i",{class:"mdi-chevron-right mdi v-icon"})]),t("li",{class:"v-breadcrumbs-item"},[t("a",{class:"v-breadcrumbs-item--link",href:"#"},[t("p",null,"รายงานแบ่งตามไตรมาส")])])])])])])],-1)])),_:1}),d(D,{cols:"12"},{default:h(()=>[d(Y,{elevation:"10"},{default:h(()=>[d(A,null,{default:h(()=>[t("div",rt,[t("div",nt,[t("div",it,[t("div",null,[t("h3",ct,"รายงานยอดเซ็นสัญญาแบ่งตามไตรมาส ประจำปี "+m(c.value),1),e[2]||(e[2]=t("h5",{class:"card-subtitle",style:{"text-align":"left"}},"(หน่วย : ล้านบาท)",-1))])])]),t("div",ut,[t("div",dt,[d(st,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=o=>c.value=o),label:"เลือกปี",items:ot(O),class:"mr-4"},null,8,["modelValue","items"])])])]),t("div",ht,[d(n,{height:"350",options:z.value,series:R.value},null,8,["options","series"])])]),_:1})]),_:1})]),_:1}),d(D,{cols:"12"},{default:h(()=>[d(Y,{elevation:"10"},{default:h(()=>[d(A,null,{default:h(()=>[t("div",mt,[t("div",ft,[t("div",vt,[t("div",null,[t("h3",pt,"ตารางยอดเซ็นสัญญาแบ่งตามไตรมาส ประจำปี "+m(c.value),1),e[3]||(e[3]=t("h5",{class:"card-subtitle",style:{"text-align":"left"}},"(หน่วย : ล้านบาท)",-1))])])]),t("div",_t,[t("div",gt,[d(at,{class:"text-primary v-btn--size-large",onClick:P},{default:h(()=>e[4]||(e[4]=[t("div",{class:"text-none font-weight-regular muted"},"Export to CSV",-1)])),_:1})])])]),t("div",bt,[t("div",xt,[t("table",null,[t("thead",yt,[t("tr",null,[e[5]||(e[5]=t("th",{class:"text-h6"},"Financial Summary",-1)),t("th",{class:"text-h6",colspan:i.value.length+1,style:{"text-align":"center","border-bottom":"2px solid #00A6D4"}},m(c.value),9,wt)]),t("tr",null,[e[6]||(e[6]=t("th",{class:"text-subtitle-1",style:{"font-weight":"400"}},"(Unit: THB million)",-1)),(u(!0),f(b,null,y(i.value,o=>(u(),f("th",{key:o,class:"text-h6"},m(o),1))),128)),t("th",Ft,m(c.value),1)])]),t("tbody",null,[(u(),f(b,null,y(x,o=>(u(),f(b,{key:o},[t("tr",St,[t("td",kt,[t("h6",Tt,m(o),1)]),(u(!0),f(b,null,y(i.value,l=>(u(),f("td",{key:o+"-"+l}))),128))]),(u(),f(b,null,y(k,l=>t("tr",{key:o+"-"+l},[t("td",null,[t("h6",Et,m(l),1)]),(u(!0),f(b,null,y(i.value,a=>{var r,v;return u(),f("td",{key:l+"-"+o+"-"+a},[t("h6",Ct,m(H(((v=(r=_.value[a.split(" ")[0]])==null?void 0:r[o])==null?void 0:v[T[l]])||0)),1)])}),128)),t("td",Bt,m($(o,T[l])),1)])),64))],64))),64))])])])])]),_:1})]),_:1})]),_:1})]),_:1})}}});export{Ht as default};
