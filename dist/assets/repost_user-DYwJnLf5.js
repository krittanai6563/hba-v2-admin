import{k as ve,l as u,L as pe,C as fe,m as ce,e as be,w as l,P as F,o as B,b as t,N as $,O as N,a as s,a9 as ye,V as M,X as L,aa as A,ab as G,c as Y,f as ge,ac as X,M as i,ad as f,d as r,a3 as C,S as g,ae as he,t as U,H as _e,G as Ve,z as xe,y as we,u as ke,h as Me,x as Ue,a4 as Be}from"./index-DIUjx3mN.js";import{d as K}from"./img-logo_0-DZHFey1b.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Se={class:"v-row"},Ee={class:"v-col-md-6 v-col-12 text-right"},Te={class:"d-flex justify-end v-col-md-12 v-col-lg-12 v-col-12"},Fe={key:0,class:"mt-3"},$e={class:"v-card-text"},Ne={class:"v-table v-theme--BLUE_THEME v-table--density-default month-table"},Ye={class:"v-table__wrapper"},He={key:0},De={class:"ps-0 py-3"},Ie={class:"d-flex align-center"},Re=["src"],Le={class:"mx-4"},Ae={class:"text-16 text-no-wrap font-weight-medium"},ze={class:"text-subtitle-1",style:{color:"red"}},Oe={class:"text-end"},Pe={class:"text-no-wrap text-subtitle-1 textSecondary"},je={class:"d-flex align-center"},qe=["onClick"],Je=["onSubmit"],Ge=["onClick"],Xe=ve({__name:"repost_user",setup(Ke){const z=u(["วิสามัญ","วิสามัญ ก","สมทบ"]),h=u("วิสามัญ"),_=u(""),V=u(""),H=u(""),S=u(!1);u("");const O=u(["user","admin"]),x=u("user"),P=u({required:a=>!!a||"Required.",min:a=>a.length>=8||"Min 8 characters",emailMatch:()=>"The email and password you entered don't match"}),d=u(""),w=u(!1),y=u(null),Q=()=>{y.value?console.log("File selected:",y.value):d.value="กรุณาอัพโหลดไฟล์รูปภาพเท่านั้น!"};async function W(){d.value="",w.value=!1;try{const a=new FormData;a.append("fullname",_.value),a.append("email",V.value),a.append("password",H.value),a.append("role",x.value),a.append("member_type",h.value),y.value&&a.append("profile_image",y.value);const e=await fetch("https://thhbaadmin.infinityfreeapp.com/backend/register.php",{method:"POST",body:a}),o=await e.text();if(console.log(o),e.ok)try{let n=JSON.parse(o);d.value=n.message||"Registration successful!"}catch{d.value="Error: Invalid JSON format"}else d.value=`Registration failed: ${o}`}catch(a){a instanceof Error?d.value="Registration failed: "+a.message:d.value="Registration failed: An unexpected error occurred."}finally{w.value=!0}}const E=u([]),Z=u(["วิสามัญ","วิสามัญ ก","สมทบ","จัดการข้อมูล","ผู้ดูแลระบบ"]);u(["user","admin"]);const ee=u(["กรอกข้อมูลเรียบร้อย","ยังไม่กรอกข้อมูล"]),c=u("");u("");const b=u(""),k=u(""),p=u(""),j=pe(()=>{let a=E.value;return c.value&&c.value!=="ทั้งหมด"&&(a=a.filter(e=>e.member_type===c.value)),b.value&&b.value!=="ทั้งหมด"&&(a=a.filter(e=>e.status===b.value)),a}),D=async()=>{try{let a="https://thhbaadmin.infinityfreeapp.com/backend/get_members_master.php";if(p.value&&k.value){const[n,v]=k.value.split("-");let m=parseInt(n);m>2500||(m+=543);const me=parseInt(v);a=`https://thhbaadmin.infinityfreeapp.com/backend/get_members_master.php?buddhist_year=${m}&month_number=${me}`}else if(p.value){let n=parseInt(p.value);n>2500||(n+=543),a=`https://thhbaadmin.infinityfreeapp.com/backend/get_members_master.php?buddhist_year=${n}`}c.value&&c.value!=="ทั้งหมด"&&(a+=`&member_type=${c.value}`),b.value&&b.value!=="ทั้งหมด"&&(a+=`&status=${b.value}`),console.log("Fetching URL: ",a);const e=await fetch(a);if(!e.ok)throw new Error("Failed to fetch members");const o=await e.json();E.value=o,console.log("Members:",E.value)}catch(a){console.error(a)}};fe([p,k,c,b],()=>{D()}),ce(()=>{D()});function te(a){return!a||a.trim()===""?K:`https://thhbaadmin.infinityfreeapp.com/backend/backend/${a}`}function le(a){const e=Number(a);return isNaN(e)?"-":e.toLocaleString("th-TH",{style:"currency",currency:"THB"})}const I=u([]),ae=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],R=new Date().getFullYear(),se=new Date().getMonth()+1,q=p.value||R.toString();for(let a=1;a<=(q===R.toString()?se:12);a++){const e=a<10?`0${a}`:`${a}`;I.value.push({value:`${q}-${e}`,label:ae[a-1]})}console.log(I.value);const J=u([]);for(let a=0;a<7;a++){const e=R-a+543;J.value.push(e.toString())}const oe=u(!1);let T=null;function ne(a){T=a;const e=E.value.find(o=>o.id===T);e&&(_.value=e.fullname||"",V.value=e.email||"",h.value=e.member_type||"",x.value=e.role||"user"),oe.value=!0}async function ue(a){if(!T){d.value="No member selected for update.";return}try{const e=new FormData;e.append("id",T.toString()),e.append("fullname",_.value),e.append("email",V.value),e.append("role",x.value),e.append("member_type",h.value),y.value&&e.append("profile_image",y.value);const o=await fetch("https://thhbaadmin.infinityfreeapp.com/backend/edit_profile.php",{method:"POST",body:e}),n=await o.text();if(console.log(n),o.ok)try{let v=JSON.parse(n);d.value=v.message||"Profile updated successfully!",w.value=!0,a.value=!1,setTimeout(()=>{w.value=!1},3e3),await D()}catch{d.value="Error: Invalid JSON format"}else d.value=`Update failed: ${n}`}catch(e){e instanceof Error?d.value="Update failed: "+e.message:d.value="Update failed: An unexpected error occurred."}}function de(){w.value=!1,d.value=""}const ie=xe(),re=a=>{if(!p.value||!k.value){alert("กรุณาเลือกปีและเดือนก่อน");return}let e=parseInt(p.value);e>2500||(e+=543);const n=parseInt(k.value.split("-")[1]);ie.push({name:"post_repost_user",query:{memberId1:a,buddhist_year:e,month_number:n}})};return(a,e)=>(B(),be(F,null,{default:l(()=>[t(i,{cols:"12",sm:"12",lg:"12"},{default:l(()=>[t($,{elevation:"0"},{default:l(()=>[t(N,null,{default:l(()=>[s("div",Se,[e[26]||(e[26]=s("div",{class:"v-col-md-6 v-col-12"},[s("div",{class:"d-flex align-center"},[s("div",null,[s("h3",{class:"card-title mb-1"},"ลงทะเบียนสมาชิก"),s("h5",{class:"card-subtitle",style:{"text-align":"left"}},"จัดการข้อมูลสมาชิกสมาคม")])])],-1)),s("div",Ee,[s("div",Te,[t(ye,{color:"#b2d7ef",density:"comfortable",rounded:"pill",divided:""},{default:l(()=>[t(M,{class:"v-btn v-btn--flat v-theme--BLUE_THEME bg-primary v-btn--density-default v-btn--rounded v-btn--size-default"},{default:l(()=>[e[25]||(e[25]=s("div",{class:"text-none font-weight-regular primary"},"เพิ่มข้อมูลสมาชิกสมาคม",-1)),t(L,{activator:"parent","max-width":"800"},{default:l(({isActive:o})=>[t($,{rounded:"lg"},{default:l(()=>[t(A,{class:"d-flex justify-space-between align-center ps-5 py-5"},{default:l(()=>[e[17]||(e[17]=s("div",{class:"text-h5 text-medium-emphasis ps-2"},[s("h3",{class:"text-h3 mb-1"},"ลงทะเบียนสมาชิก"),s("div",{class:"text-subtitle-1 opacity-80",style:{"font-weight":"300"}}," เพิ่มข้อมูลสมาชิกสมาคม ")],-1)),t(M,{icon:"mdi-close",variant:"text",onClick:n=>o.value=!1},null,8,["onClick"])]),_:2},1024),t(G,{class:"mb-4"}),t(N,null,{default:l(()=>[s("form",{onSubmit:X(W,["prevent"])},[t(F,null,{default:l(()=>[t(i,{cols:"12",sm:"6"},{default:l(()=>[t(f,{class:"mb-1"},{default:l(()=>e[18]||(e[18]=[r("ชื่อบริษัท")])),_:1}),t(C,{id:"fullname",modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=n=>_.value=n),variant:"outlined","hide-details":"",color:"primary"},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",sm:"6"},{default:l(()=>[t(f,{class:"mb-1"},{default:l(()=>e[19]||(e[19]=[r("ประเภทสมาชิก")])),_:1}),t(g,{items:z.value,modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=n=>h.value=n)},null,8,["items","modelValue"])]),_:1}),t(i,{cols:"12",sm:"6"},{default:l(()=>[t(f,{class:"mb-1"},{default:l(()=>e[20]||(e[20]=[r("อีเมล")])),_:1}),t(C,{variant:"outlined",type:"email","hide-details":"",color:"primary",id:"email",modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=n=>V.value=n)},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",sm:"6"},{default:l(()=>[t(f,{class:"mb-1"},{default:l(()=>e[21]||(e[21]=[r("รหัสผ่าน")])),_:1}),t(C,{id:"password",modelValue:H.value,"onUpdate:modelValue":e[3]||(e[3]=n=>H.value=n),"append-icon":S.value?"mdi-eye":"mdi-eye-off",rules:[P.value.required,P.value.min],type:S.value?"text":"password",name:"input-10-1",hint:"At least 8 characters",counter:"","onClick:append":e[4]||(e[4]=n=>S.value=!S.value),"hide-details":""},null,8,["modelValue","append-icon","rules","type"])]),_:1}),t(i,{cols:"12"},{default:l(()=>[t(f,{class:"mb-1"},{default:l(()=>e[22]||(e[22]=[r("สิทธิการเข้าถึงข้อมูล")])),_:1}),t(g,{items:O.value,modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=n=>x.value=n),"hide-details":""},null,8,["items","modelValue"])]),_:1}),t(i,{cols:"12"},{default:l(()=>[t(f,{class:"mb-1"},{default:l(()=>e[23]||(e[23]=[r("อัพโหลดรูปโปรไฟล์")])),_:1}),t(he,{label:"File input",modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=n=>y.value=n),accept:"image/*",onChange:Q},null,8,["modelValue"])]),_:1}),t(i,{cols:"12"},{default:l(()=>[t(M,{type:"submit",color:"primary",size:"large",block:"",flat:"",class:"w-100"},{default:l(()=>e[24]||(e[24]=[r(" สมัครสมาชิก ")])),_:1})]),_:1})]),_:1})],32),d.value?(B(),Y("p",Fe,U(d.value),1)):ge("",!0)]),_:1}),t(G,{class:"mt-2"})]),_:2},1024)]),_:1})]),_:1})]),_:1})])])]),e[39]||(e[39]=s("br",null,null,-1)),e[40]||(e[40]=s("br",null,null,-1)),t(F,{class:"mb-4"},{default:l(()=>[t(i,{cols:"12",sm:"3"},{default:l(()=>[t(g,{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=o=>p.value=o),items:J.value,label:"ประจำปี",dense:"",clearable:"","menu-props":{maxHeight:"200"}},null,8,["modelValue","items"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:l(()=>[t(g,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=o=>k.value=o),items:I.value,label:"เดือน",dense:"",clearable:"","item-title":"label","item-value":"value",disabled:!p.value,"menu-props":{maxHeight:"200"}},null,8,["modelValue","items","disabled"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:l(()=>[t(g,{modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=o=>c.value=o),items:["ทั้งหมด",...Z.value],label:"ประเภทสมาชิก",dense:"",clearable:"","menu-props":{maxHeight:"200"}},null,8,["modelValue","items"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:l(()=>[t(g,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=o=>b.value=o),items:["ทั้งหมด",...ee.value],label:"สถานะ",dense:"",clearable:"","menu-props":{maxHeight:"200"}},null,8,["modelValue","items"])]),_:1})]),_:1}),s("div",$e,[s("div",Ne,[s("div",Ye,[s("table",null,[e[38]||(e[38]=s("thead",null,[s("tr",null,[s("th",{class:"text-subtitle-1 font-weight-medium ps-2"},"สมาชิก"),s("th",{class:"text-subtitle-1 font-weight-medium"},"สถานะ"),s("th",{class:"text-subtitle-1 font-weight-medium text-end"},"มูลค่า"),s("th",{class:"text-subtitle-1 font-weight-medium"})])],-1)),s("tbody",null,[j.value.length===0?(B(),Y("tr",He,e[27]||(e[27]=[s("td",{colspan:"4",class:"text-center text-subtitle-1 py-4"}," ไม่พบข้อมูลมูลสมาชิก",-1)]))):(B(!0),Y(Ve,{key:1},_e(j.value,(o,n)=>(B(),Y("tr",{key:n},[s("td",De,[s("div",Ie,[t(we,{size:"30"},{default:l(()=>[s("img",{src:te(o.profile_image),alt:"user",style:{width:"30px",height:"30px","border-radius":"50%","object-fit":"cover"},onError:e[11]||(e[11]=v=>{const m=v.target;m&&(m.src=ke(K))})},null,40,Re)]),_:2},1024),s("div",Le,[s("h4",Ae,U(o.fullname),1),s("span",ze,U(o.member_type),1)])])]),s("td",null,[t(Me,{color:o.status==="กรอกข้อมูลเรียบร้อย"?"success":"error",label:"",small:"",class:"ma-2 rounded-pill"},{default:l(()=>[r(U(o.status),1)]),_:2},1032,["color"])]),s("td",Oe,[s("h4",Pe,U(le(o.contractValue)),1)]),s("td",null,[s("div",je,[t(L,{"max-width":"600"},{activator:l(({props:v})=>[t(M,Ue({ref_for:!0},v,{variant:"flat"}),{default:l(()=>[s("button",{type:"button",onClick:m=>ne(o.id),class:"v-btn v-btn--flat v-btn--icon v-theme--BLUE_THEME v-btn--density-default v-btn--size-default v-btn--variant-elevated","aria-describedby":"v-tooltip-884"},e[28]||(e[28]=[s("span",{class:"v-btn__overlay"},null,-1),s("span",{class:"v-btn__underlay"},null,-1),s("span",{class:"v-btn__content","data-no-activator":""},[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon-tabler icon-tabler-pencil text-primary",width:"20px",height:"20px",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},[s("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),s("path",{d:"M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4"}),s("path",{d:"M13.5 6.5l4 4"})])],-1)]),8,qe)]),_:2},1040)]),default:l(({isActive:v})=>[t($,{rounded:"lg"},{default:l(()=>[t(A,null,{default:l(()=>e[29]||(e[29]=[r(" แก้ไขข้อมูลสมาชิก ")])),_:1}),t(N,null,{default:l(()=>[s("form",{onSubmit:X(m=>ue(v),["prevent"])},[t(F,null,{default:l(()=>[t(i,{cols:"12",sm:"6"},{default:l(()=>[t(f,null,{default:l(()=>e[30]||(e[30]=[r("ชื่อบริษัท")])),_:1}),t(C,{modelValue:_.value,"onUpdate:modelValue":e[12]||(e[12]=m=>_.value=m),readonly:""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",sm:"6"},{default:l(()=>[t(f,null,{default:l(()=>e[31]||(e[31]=[r("ประเภทสมาชิก")])),_:1}),t(g,{modelValue:h.value,"onUpdate:modelValue":e[13]||(e[13]=m=>h.value=m),items:z.value},null,8,["modelValue","items"])]),_:1}),t(i,{cols:"12"},{default:l(()=>[t(f,null,{default:l(()=>e[32]||(e[32]=[r("อีเมล")])),_:1}),t(C,{modelValue:V.value,"onUpdate:modelValue":e[14]||(e[14]=m=>V.value=m),readonly:""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12"},{default:l(()=>[t(f,null,{default:l(()=>e[33]||(e[33]=[r("สิทธิการเข้าถึงข้อมูล")])),_:1}),t(g,{modelValue:x.value,"onUpdate:modelValue":e[15]||(e[15]=m=>x.value=m),items:O.value},null,8,["modelValue","items"])]),_:1}),t(i,{cols:"12"},{default:l(()=>[t(M,{type:"submit",color:"primary"},{default:l(()=>e[34]||(e[34]=[r("บันทึกการแก้ไข")])),_:1})]),_:1})]),_:1})],40,Je)]),_:2},1024)]),_:2},1024)]),_:2},1024),s("button",{onClick:v=>re(o.id),type:"button",class:"v-btn v-btn--flat v-btn--icon v-theme--BLUE_THEME v-btn--density-default v-btn--size-default v-btn--variant-elevated","aria-describedby":"v-tooltip-886"},e[35]||(e[35]=[s("span",{class:"v-btn__overlay"},null,-1),s("span",{class:"v-btn__underlay"},null,-1),s("span",{class:"v-btn__content","data-no-activator":""},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24"},[s("path",{fill:"#001dff","fill-rule":"evenodd",d:"M11.5 2.75a8.75 8.75 0 1 0 0 17.5a8.75 8.75 0 0 0 0-17.5M1.25 11.5c0-5.66 4.59-10.25 10.25-10.25S21.75 5.84 21.75 11.5c0 2.56-.939 4.902-2.491 6.698l3.271 3.272a.75.75 0 1 1-1.06 1.06l-3.272-3.271A10.2 10.2 0 0 1 11.5 21.75c-5.66 0-10.25-4.59-10.25-10.25","clip-rule":"evenodd"})])],-1)]),8,Ge)]),t(L,{modelValue:w.value,"onUpdate:modelValue":e[16]||(e[16]=v=>w.value=v),"max-width":"400px"},{default:l(()=>[t($,null,{default:l(()=>[t(A,{class:"text-h6"},{default:l(()=>e[36]||(e[36]=[r("แจ้งเตือน")])),_:1}),t(N,null,{default:l(()=>[r(U(d.value),1)]),_:1}),t(Be,null,{default:l(()=>[t(M,{color:"primary",text:"",onClick:de},{default:l(()=>e[37]||(e[37]=[r("ปิด")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]))),128))])])])])])]),_:1})]),_:1})]),_:1})]),_:1}))}}),tt=Ce(Xe,[["__scopeId","data-v-44713450"]]);export{tt as default};
